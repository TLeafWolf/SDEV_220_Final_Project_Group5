{% extends 'inventory/base.html' %}

{% block title %}Pet Supplies Inventory{% endblock %}

{% block extra_css %}
<style>
    .conmain {
        background-color: #45a049;
        width: 1000px; /* Set the container width to 1000px */
        padding: 30px;
        border-radius: 10px;
        margin: 0 auto; /* Center the container */
    }
    
    @font-face {
        font-family: 'Bauhaus 93';
        src: url('fonts/Bauhaus 93 Regular.ttf') format('truetype');
    }
    
    .table-container {
        width: 100%; /* Full width of the container */
        max-height: 650px; /* Set a maximum height for the table container */
        overflow-x: hidden; /* Prevent horizontal scrolling */
    }
    
    .data_tab {
        width: 100%; /* Set the table width to 100% of the container */
        border-collapse: collapse; /* Merge borders for a cleaner look */
        table-layout: fixed; /* Fixed layout to ensure consistent column widths */
        margin: 0; /* Remove margin */
    }
    
    /* Set specific widths for each column in the header */
    .name_head {
        width: 300px; /* Width for Name */
    }
    
    .Price_head {
        width: 200px; /* Width for Price */
    }
    
    .Quan_head {
        width: 250px; /* Width for Quantity */
    }
    
    .loc_head {
        width: 150px; /* Width for Location */
    }
    
    .edit_head {
        width: 50px; /* Width for Edit button */
    }
    
    .del_head {
        width: 50px; /* Width for Delete button */
    }

    /* Table header styles */
    .data_tab th {
        text-align: center; /* Align text to the center */
        border: 1px solid #ddd; /* Add a border to header cells */
        padding: 10px; /* Add padding for better spacing */
        background-color: #F6DE60; /* Header background color */
        font-weight: bold; /* Make header text bold */
    }

    /* Table body styles */
    .data_tab td {
        text-align: center; /* Align text to the center */
        border: 1px solid #ddd; /* Add a border to table cells */
        padding: 10px; /* Add padding for better spacing */
        white-space: nowrap; /* Prevent text from wrapping */
    }

    .changes {
        word-wrap: break-word; /* Allow long text to wrap within the cell */
        max-width: 200px; /* Set a max width for the changes column */
    }
    
    h2 {
        font-family: 'Bauhaus 93', Arial, sans-serif;
        font-size: 32px; /* Font size in pixels */
        color: black;
        text-align: center;
        margin-bottom: 20px;
    }
    
    .back-button {
        background-color: #F6DE60;
        color: #333;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 600;
        transition: background-color 0.3s;
    }
    
    .back-button:hover {
        background-color: #e6ce50;
    }
    
    td {
        border-bottom: 1px solid #ddd;
    }
    
    tr:hover {
        background-color: #f5f5f5;
    }
    
    .bottom_nav tr {
        background-color: transparent; /* Set background to transparent */
    }
    
    .bottom_nav tr:hover {
        background-color: transparent; /* Ensure background remains transparent on hover */
    }
    
    .bottom_nav {
        border: none; /* Remove the border from the bottom_nav table */
    }
    
    .bottom_nav td {
        border: none; /* Remove borders from table cells */
    }
    
    .bottom_nav button {
        background-color: #F6DE60;
        color: black;
    }
    
    .filter button {
        background-color: #F6DE60;
        color: black;
    }
</style>


{% endblock %}

{% block content %}
{% if low_stock_items %}
    <div class="warning">
        <p style="color: red;"><strong>Warning:</strong> Some supplies are low in stock!
        <a href="{% url 'index' %}?low_stock=true" class="filter-button">View</a></p>
    </div>  
{% else %}
    <div class="status-message success">
        <p style="color: green;">All supplies are adequately stocked.</p>
    </div>
{% endif %}
<center>
    <div class="conmain">
        <div class="filter">
            <form method="get" style="margin-bottom: 1rem;">
                <input type="text" name="name" placeholder="Filter by name..." value="{{ name_query }}">
                <input type="text" name="location" placeholder="Filter by location..." value="{{ location_query }}" style="width: 110px;">
                <button type="submit">Filter</button>
                <a href="{% url 'index' %}"><button type="button">Reset</button></a>
            </form>
        </div>
    
        <center>{% if user.is_authenticated %}
            <a href="{% url 'add_supply' %}">
                <p></p>
            </a>
            {% else %}
            <div style="color: red;">
                <strong>Please log in to add, edit, or delete supplies.</strong>
            </div>
            {% endif %}</center> 
    
        <div class="table-container">
            <div class="table-header">
                <table border="1" class="data_tab">
                    <thead>
                        <tr>
                            <th class="name_head">Name</th>
                            <th class="Price_head">Price</th>
                            <th class="Quan_head">Quantity</th>
                            <th class="loc_head">Location</th>
                            <th class="edit_head"></th>
                            <th class="del_head">
                                {% if user.is_authenticated %}
                                    <a href="{% url 'add_supply' %}">
                                        <button type="button" class="add-button">Add</button>
                                    </a>
                                {% endif %}
                            </th>
                        </tr>
                    </thead>
                </table>
            </div>
            
            <div class="table-body">
                <table border="1" class="data_tab">
                    <tbody>
                        {% for supply in supplies %}
                        <tr {% if supply.quantity < 6 %}style="background-color: #ffcccc;"{% endif %}>
                            <td class="name_row">{{ supply.name }}</td>
                            <td class="Price_row" onclick="editField(this, 'price', '{{ supply.name }}')">
                                <span class="display">${{ supply.price|floatformat:2 }}</span>
                                <input type="text" class="edit" value="{{ supply.price|floatformat:2 }}" style="display:none; width: 80%; box-sizing: border-box;" onblur="saveField(this, 'price', '{{ supply.name }}')">
                            </td>
                            <td class="Quan_row" onclick="editField(this, 'quantity', '{{ supply.name }}')">
                                <span class="display">{{ supply.quantity }}</span>
                                <input type="text" class="edit" value="{{ supply.quantity }}" style="display:none; width: 80%; box-sizing: border-box;" onblur="saveField(this, 'quantity', '{{ supply.name }}')">
                            </td>
                            <td class="loc_row" onclick="editField(this, 'location', '{{ supply.name }}')">
                                <span class="display">{{ supply.location }}</span>
                                <input type="text" class="edit" value="{{ supply.location }}" style="display:none; width: 80%; box-sizing: border-box;" onblur="saveField(this, 'location', '{{ supply.name }}')">
                            </td>
                            <td class='edit_button'>
                                <center>
                                    {% if user.is_authenticated %}
                                        <a href="{% url 'edit_supply' supply.name %}"><button type="button">Edit</button></a>
                                    {% endif %}
                                </center>
                            </td>
                            <td class='Del_button'>
                                {% if user.is_authenticated %}
                                    <form action="{% url 'delete_supply' supply.name %}" method="post" style="display:inline;" onsubmit="return confirmDelete();">
                                        {% csrf_token %}
                                        <button type="submit">Delete</button>
                                    </form>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5">No supplies available.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    
        <table class="bottom_nav">
            <tr>
                {% if user.is_authenticated %}
                <td><a href="{% url 'audit_log' %}"><button type="button">Audit Log</button></a></td>
                {% endif %}
                {% if user.is_authenticated %}
                <td class="blank"></td>
                <td class="export">
                    <a href="{% url 'export_supplies' %}">
                        <button type="button">Export</button>
                    </a>
                </td>
                <td class="import">
                    <a href="{% url 'import_supplies' %}">
                        <button type="button">Import</button>
                    </a>
                </td>
                {% endif %}
            </tr>
        </table>
    </div>
    
{% endblock %}

{% block extra_js %}
{% if user.is_authenticated %}

<script>
   
        function editField(cell, fieldType, supplyName) {
    const display = cell.querySelector('.display');
    const input = cell.querySelector('.edit');


    display.style.display = 'none';
    input.style.display = 'inline';
    input.focus();


 
    input.addEventListener('keydown', function(event) {
        if (event.key === 'Enter') {
            saveField(input, fieldType, supplyName);
        }
    });
}


function saveField(input, fieldType, supplyName) {
    const newValue = input.value;


   
    const formattedValue = `${parseFloat(newValue).toFixed(2)}`;




    input.style.display = 'none';
    const display = input.previousElementSibling;
    display.textContent = formattedValue;
    display.style.display = 'inline';


    fetch(`/update_supply/${supplyName}/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({ [fieldType]: newValue })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        console.log('Success:', data);
        location.reload();
    })
    .catch((error) => {
        console.error('Error:', error);
    });
}






    function confirmDelete() {
        return confirm("Are you sure you want to delete this item?");
    }
</script>
{% endif %}


{% endblock %}
